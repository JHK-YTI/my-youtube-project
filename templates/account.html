{% extends 'layout.html' %}

{% block title %}마이페이지{% endblock %}

{% block head %}
    <style>
        .form-label { display: block; font-weight: 600; color: #374151; margin-bottom: 0.5rem; }
        .form-input { width: 100%; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.5rem; transition: border-color 0.2s, box-shadow 0.2s; }
        .form-input:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 3px rgb(79 70 229 / 0.2); }
        .btn { display: block; width: 100%; padding: 0.75rem 1rem; border-radius: 0.5rem; font-weight: 600; color: white; text-align: center; transition: background-color 0.2s; }
        .btn-primary { background-color: #4f46e5; }
        .btn-primary:hover { background-color: #4338ca; }
    </style>
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto p-4 sm:p-8">
    <div class="text-center mb-10">
        <h1 class="text-4xl font-bold text-gray-800">마이페이지</h1>
        <p class="text-lg text-gray-600 mt-2">회원님의 정보를 관리하고, 서비스를 이용해보세요.</p>
    </div>

    <div class="lg:flex lg:gap-8">
        <div class="lg:w-2/3 space-y-8">
            <div class="bg-white rounded-2xl shadow-lg">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8 px-8" aria-label="Tabs">
                        <button onclick="changeTab(this, 'info-panel')" class="tab-button text-indigo-600 border-indigo-500 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">계정 정보</button>
                        <button onclick="changeTab(this, 'password-panel')" class="tab-button text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">비밀번호 변경</button>
                        <button onclick="changeTab(this, 'feedback-panel')" class="tab-button text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">건의 및 문의</button>
                    </nav>
                </div>
                <div class="p-8">
                    <div id="info-panel" class="tab-pane">
                        <div class="space-y-4">
                            <div><label class="form-label">사용자 이름</label><p class="p-3 bg-gray-100 rounded-lg text-gray-700">{{ current_user.username }}</p></div>
                            <div><label class="form-label">이메일 주소</label><p class="p-3 bg-gray-100 rounded-lg text-gray-700">{{ current_user.email }}</p></div>
                        </div>
                    </div>
                    <div id="password-panel" class="tab-pane hidden">
                        <form method="POST" action="{{ url_for('account') }}">
                            {{ password_form.hidden_tag() }}
                            <div class="space-y-4">
                                <div><label for="password-current_password" class="form-label">현재 비밀번호</label>{{ password_form.current_password(class="form-input", id="password-current_password") }}</div>
                                <div><label for="password-new_password" class="form-label">새 비밀번호</label>{{ password_form.new_password(class="form-input", id="password-new_password") }}</div>
                                <div><label for="password-confirm_password" class="form-label">새 비밀번호 확인</label>{{ password_form.confirm_password(class="form-input", id="password-confirm_password") }}</div>
                                <div>{{ password_form.submit(class="btn btn-primary mt-2") }}</div>
                            </div>
                        </form>
                    </div>
                    <div id="feedback-panel" class="tab-pane hidden">
                        <form method="POST" action="{{ url_for('account') }}">
                            {{ feedback_form.hidden_tag() }}
                            <div class="space-y-4">
                                <div><label for="feedback-subject" class="form-label">제목</label>{{ feedback_form.subject(class="form-input", id="feedback-subject") }}</div>
                                <div><label for="feedback-content" class="form-label">내용</label>{{ feedback_form.content(class="form-input", id="feedback-content", rows="5") }}</div>
                                <div>{{ feedback_form.submit(class="btn btn-primary mt-2") }}</div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="p-8 bg-white rounded-2xl shadow-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4">최근 분석 기록</h3>
                <div class="space-y-3">
                {% if history %}
                    {% for item in history %}
                        <div class="p-3 bg-gray-50 rounded-lg text-sm text-gray-800 truncate"><i class="fas fa-video text-gray-400 mr-2"></i>{{ item.video_title }}</div>
                    {% endfor %}
                    <a href="#" class="block text-center text-sm text-indigo-600 hover:underline mt-4">전체 기록 보기 (준비 중)</a>
                {% else %}
                    <p class="text-center text-gray-500 py-4">아직 분석 기록이 없습니다.</p>
                {% endif %}
                </div>
            </div>
        </div>

        <div class="lg:w-1/3 space-y-8 mt-8 lg:mt-0">
            <div class="p-8 bg-white rounded-2xl shadow-lg space-y-8">
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">계정 개요</h3>
                    <div class="text-gray-700 space-y-3">
                        <p><strong>가입일:</strong> {{ current_user.created_at.strftime('%Y년 %m월 %d일') if current_user.created_at else '정보 없음' }}</p>
                        <p><strong>구독 상태:</strong> <span class="font-semibold text-green-600">무료 사용자</span></p>
                        <p><strong>총 분석 횟수:</strong> {{ history|length }}회</p>
                    </div>
                </div>
                <hr>
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">구독 관리</h3>
                    <p class="text-gray-600 mb-4">더 많은 기능을 이용하시려면 플랜을 업그레이드하세요.</p>
                    <button class="w-full text-center py-2 px-4 rounded-lg bg-gray-300 text-gray-500 cursor-not-allowed" disabled>업그레이드 (준비 중)</button>
                </div>
            </div>
            <div class="p-8 bg-red-50 border border-red-200 rounded-2xl shadow-lg">
                <h3 class="text-xl font-bold text-red-800 mb-4">계정 삭제</h3>
                <p class="text-red-700 mb-4 text-sm">계정을 삭제하면 모든 데이터가 영구적으로 사라지며, 복구할 수 없습니다.</p>
                <button class="w-full text-center py-2 px-4 rounded-lg bg-gray-300 text-gray-500 cursor-not-allowed" disabled>계정 삭제하기 (준비 중)</button>
            </div>
        </div>
    </div>
    <div class="text-center mt-12">
        <a href="{{ url_for('start') }}" class="text-gray-600 hover:text-gray-800 font-semibold transition">
            <i class="fas fa-arrow-left mr-2"></i> 메인으로 돌아가기
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function changeTab(selectedButton, tabId) {
        document.querySelectorAll('.tab-button').forEach(button => {
            button.classList.remove('text-indigo-600', 'border-indigo-500');
            button.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
        });
        selectedButton.classList.add('text-indigo-600', 'border-indigo-500');
        selectedButton.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
        
        document.querySelectorAll('.tab-pane').forEach(pane => {
            pane.classList.add('hidden');
        });
        document.getElementById(tabId).classList.remove('hidden');
    }
</script>
{% endblock %}