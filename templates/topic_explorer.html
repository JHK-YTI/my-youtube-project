<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI 주제 탐색기 - 튜브인사이트</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .topic-card:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .btn-primary {
             background-color: #7c3aed; /* purple-600 */
        }
        .btn-primary:hover {
            background-color: #6d28d9; /* purple-700 */
        }
        .btn-secondary {
            background-color: #16a34a; /* green-600 */
        }
        .btn-secondary:hover {
            background-color: #15803d; /* green-700 */
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-8">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-800">AI 주제 탐색기</h1>
            <p class="text-lg text-gray-600 mt-3">AI의 도움을 받아 콘텐츠 아이디어를 얻고, 클릭 한 번으로 대본까지 완성하세요.</p>
        </div>

        <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold text-gray-700 mb-3"><i class="fas fa-keyboard mr-2"></i>내가 원하는 카테고리 분석</h2>
                <p class="text-gray-600 mb-4 text-sm">분석하고 싶은 카테고리를 직접 입력하여 관련 주제를 추천받으세요.</p>
                <form id="user-category-form" class="flex">
                    <input type="text" id="category-input" name="category" class="w-full px-4 py-2 text-gray-700 bg-gray-100 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="예: 자동차, 요리, 여행" required>
                    <button type="submit" class="btn-secondary flex-shrink-0 text-white font-bold px-5 py-2 rounded-r-lg transition-colors">
                        주제 추천받기
                    </button>
                </form>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold text-gray-700 mb-3"><i class="fas fa-chart-line mr-2"></i>최신 트렌드 분석</h2>
                <p class="text-gray-600 mb-4 text-sm">AI가 지금 가장 인기있는 최신 트렌드를 분석하여 카테고리를 추천합니다.</p>
                <button id="get-trends-btn" class="w-full btn-primary text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">
                    <i class="fas fa-lightbulb mr-2"></i> 최신 트렌드 카테고리 추천받기
                </button>
            </div>
        </div>

        <div id="loading-spinner" class="hidden text-center py-10">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"></div>
            <p class="mt-4 text-gray-600 font-semibold">AI가 아이디어를 생성 중입니다. 잠시만 기다려주세요...</p>
        </div>
        <div id="results-container"></div>
        
         <div class="text-center mt-12">
            <a href="/start" class="text-indigo-600 hover:text-indigo-800 font-semibold">
                <i class="fas fa-arrow-left mr-2"></i>이전 메뉴로
            </a>
        </div>
    </div>

    <script>
        const resultsContainer = document.getElementById('results-container');
        const loadingSpinner = document.getElementById('loading-spinner');
        const getTrendsBtn = document.getElementById('get-trends-btn');
        const userCategoryForm = document.getElementById('user-category-form');

        // 공통 요청 함수
        function fetchIdeas(formData) {
            resultsContainer.innerHTML = '';
            loadingSpinner.classList.remove('hidden');
            getTrendsBtn.disabled = true;
            userCategoryForm.querySelector('button').disabled = true;

            fetch('/get_topic_ideas', { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    renderResults(data);
                })
                .catch(error => {
                    resultsContainer.innerHTML = `<p class="text-center text-red-500 font-bold">아이디어 요청 중 오류가 발생했습니다: ${error}</p>`;
                })
                .finally(() => {
                    loadingSpinner.classList.add('hidden');
                    getTrendsBtn.disabled = false;
                    userCategoryForm.querySelector('button').disabled = false;
                });
        }
        
        // AI 트렌드 추천 버튼 클릭 이벤트
        getTrendsBtn.addEventListener('click', function() {
            fetchIdeas(new FormData()); // 빈 폼 데이터 전송
        });

        // 사용자 카테고리 입력 폼 제출 이벤트
        userCategoryForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetchIdeas(formData);
        });

        // 결과 렌더링 함수
        function renderResults(data) {
            resultsContainer.innerHTML = '';
             if (data.error) {
                resultsContainer.innerHTML = `<p class="text-center text-red-500 font-bold">${data.error}</p>`;
            } else {
                data.ideas.forEach(category => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'mb-10';

                    const categoryTitle = document.createElement('h2');
                    categoryTitle.className = 'text-2xl font-bold text-gray-700 border-b-2 border-purple-200 pb-2 mb-6';
                    categoryTitle.innerHTML = `<i class="fas fa-folder-open text-purple-500 mr-3"></i>${category.category}`;
                    categoryDiv.appendChild(categoryTitle);
                    
                    const topicsGrid = document.createElement('div');
                    topicsGrid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';

                    category.topics.forEach(topicText => {
                        // 각 주제를 form으로 감싸서 클릭 시 대본 생성 페이지로 이동
                        const topicForm = document.createElement('form');
                        topicForm.action = '/generate_script_from_topic';
                        topicForm.method = 'POST';
                        topicForm.target = '_blank'; // 새 탭에서 열기
                        
                        const hiddenInput = document.createElement('input');
                        hiddenInput.type = 'hidden';
                        hiddenInput.name = 'topic';
                        hiddenInput.value = topicText;
                        
                        const topicButton = document.createElement('button');
                        topicButton.type = 'submit';
                        topicButton.className = 'w-full h-full text-left topic-card bg-white p-6 rounded-lg shadow-md transition-all duration-300';
                        topicButton.innerHTML = `<p class="font-semibold text-gray-800">${topicText}</p>`;
                        
                        topicForm.appendChild(hiddenInput);
                        topicForm.appendChild(topicButton);
                        topicsGrid.appendChild(topicForm);
                    });

                    categoryDiv.appendChild(topicsGrid);
                    resultsContainer.appendChild(categoryDiv);
                });
            }
        }
    </script>
</body>
</html>